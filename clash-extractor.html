<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Clash Config Extractor | Extract Domains and IPs from Clash Configuration</title>
    <meta name="description" content="Free online tool to extract domains and IP addresses from Clash proxy configuration files. Easy to use for network administrators and proxy users.">
    <meta name="keywords" content="Clash Config, Domain Extractor, IP Extractor, Proxy Configuration, Network Tools">
    <meta name="author" content="Akarat Tools">
    <meta name="robots" content="index, follow">
    <meta name="theme-color" content="#326ce5">

    <!-- Open Graph / Facebook -->
    <meta property="og:type" content="website">
    <meta property="og:url" content="https://akarat-tools.xyz/clash-extractor">
    <meta property="og:title" content="Clash Config Extractor - Online Tool">
    <meta property="og:description" content="Extract domains and IP addresses from Clash proxy configuration files with ease.">
    <meta property="og:image" content="https://akarat-tools.xyz/og-image.png">
    <meta property="og:site_name" content="Akarat Tools">

    <!-- Twitter -->
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:title" content="Clash Config Extractor - Online Tool">
    <meta name="twitter:description" content="Extract and convert Clash proxy configurations online. Free tool for managing Clash proxy settings.">

    <!-- Google tag (gtag.js) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-6PDQBCN90Z"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());

        gtag('config', 'G-6PDQBCN90Z');
    </script>

    <!-- Canonical URL -->
    <link rel="canonical" href="https://akarat-tools.xyz/clash-extractor.html">
    <link rel="icon" type="image/png" href="favicon.png">

    <script src="https://cdnjs.cloudflare.com/ajax/libs/js-yaml/4.1.0/js-yaml.min.js"></script>
    <style>
        :root {
            --primary-color: #326ce5;
            --background-color: #f8f9fa;
            --border-color: #dee2e6;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Arial, sans-serif;
            margin: 0;
            padding: 0;
            background-color: var(--background-color);
        }

        .nav-header {
            background-color: white;
            padding: 1rem;
            border-bottom: 1px solid var(--border-color);
            position: sticky;
            top: 0;
            z-index: 1000;
        }

        .nav-container {
            max-width: 1400px;
            margin: 0 auto;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .nav-brand {
            font-size: 1.25rem;
            font-weight: bold;
            color: #333;
            text-decoration: none;
            transition: color 0.2s;
        }

        .nav-brand:hover {
            color: var(--primary-color);
        }

        .nav-links {
            display: flex;
            gap: 1.5rem;
        }

        .nav-link {
            color: #666;
            text-decoration: none;
            padding: 0.5rem;
            border-radius: 4px;
            transition: all 0.2s;
        }

        .nav-link:hover {
            color: #333;
            background-color: #e9ecef;
        }

        .nav-link.active {
            color: var(--primary-color);
            font-weight: 500;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 2rem;
        }

        h1 {
            color: #333;
            text-align: center;
            margin-bottom: 1rem;
        }

        .description {
            text-align: center;
            margin-bottom: 2rem;
            color: #666;
        }

        .extractor-container {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 2rem;
            margin-bottom: 2rem;
        }

        .input-section, .output-section {
            background: white;
            padding: 1.5rem;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }

        textarea {
            width: 100%;
            height: 300px;
            padding: 1rem;
            border: 1px solid var(--border-color);
            border-radius: 4px;
            font-family: monospace;
            resize: vertical;
            margin-bottom: 1rem;
        }

        .button-container {
            display: flex;
            gap: 1rem;
            margin-bottom: 1rem;
        }

        button {
            padding: 0.5rem 1rem;
            background-color: var(--primary-color);
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            transition: background-color 0.2s;
        }

        button:hover {
            background-color: #2857b8;
        }

        .error {
            color: #dc3545;
            margin-top: 0.5rem;
            font-size: 0.9rem;
        }

        .results-container {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 1rem;
        }

        .result-section {
            background: white;
            padding: 1rem;
            border-radius: 4px;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
        }

        .result-section h3 {
            margin-top: 0;
            color: #333;
            font-size: 1rem;
            margin-bottom: 0.5rem;
        }

        .result-list {
            max-height: 200px;
            overflow-y: auto;
            font-family: monospace;
            font-size: 0.9rem;
            margin: 0;
            padding: 0;
            list-style: none;
        }

        .result-list li {
            padding: 0.25rem 0;
            border-bottom: 1px solid #eee;
        }

        .result-list li:last-child {
            border-bottom: none;
        }

        .result-section h3 button {
            margin-left: 8px;
            padding: 2px 8px;
            font-size: 0.8rem;
        }

        #resolvedList li {
            display: flex;
            justify-content: space-between;
            padding-right: 10px;
        }

        #resolvedList li span.domain {
            color: #666;
            margin-right: 10px;
        }

        #resolvedList li span.ip {
            color: #333;
            font-weight: 500;
        }

        .loading {
            display: inline-block;
            margin-left: 8px;
            font-size: 0.8rem;
            color: #666;
        }

        .url-input-container {
            margin-bottom: 1rem;
            display: flex;
            gap: 0.5rem;
            align-items: center;
        }

        .url-input-container input[type="url"] {
            flex: 1;
            padding: 0.5rem;
            border: 1px solid var(--border-color);
            border-radius: 4px;
            font-family: inherit;
        }

        .url-input-container button {
            white-space: nowrap;
        }

        .fetch-error {
            color: #dc3545;
            margin: 0.5rem 0;
            padding: 0.5rem;
            border-radius: 4px;
            background-color: #fde8e8;
            display: none;
        }

        .fetch-error.show {
            display: block;
        }

        @media (max-width: 768px) {
            .extractor-container {
                grid-template-columns: 1fr;
            }
        }
    </style>
    <script type="application/ld+json">
    {
      "@context": "https://schema.org",
      "@type": "WebApplication",
      "name": "Clash Configuration Extractor",
      "url": "https://akarat-tools.xyz/clash-extractor.html",
      "description": "Free online tool to extract and manage Clash proxy configurations. Convert and organize your Clash proxy settings easily.",
      "applicationCategory": "DeveloperApplication",
      "operatingSystem": "Any",
      "browserRequirements": "Requires JavaScript",
      "offers": {
        "@type": "Offer",
        "price": "0",
        "priceCurrency": "USD"
      },
      "featureList": [
        "Clash configuration extraction",
        "Proxy settings management",
        "YAML format support",
        "Client-side processing",
        "Configuration preview"
      ]
    }
    </script>
</head>
<body>
    <header class="nav-header">
        <nav class="nav-container">
            <a href="https://akarat-tools.xyz" class="nav-brand">Akarat Tools</a>
            <div class="nav-links">
                <a href="index.html" class="nav-link">AWS Policy Converter</a>
                <a href="json-to-jsonnet.html" class="nav-link">JSON to Jsonnet</a>
                <a href="hcl-to-json.html" class="nav-link">HCL to JSON</a>
                <a href="yaml-navigator.html" class="nav-link">YAML Navigator</a>
                <a href="k8s-yaml-diff.html" class="nav-link">Kubernetes YAML Diff</a>
                <a href="clash-extractor.html" class="nav-link active">Clash Extractor</a>
            </div>
        </nav>
    </header>

    <div class="container">
        <h1>Clash Configuration Extractor</h1>
        <div class="description">
            Extract domains and IP addresses from Clash proxy configuration files. Useful for network analysis and configuration.
        </div>

        <div class="extractor-container">
            <div class="input-section">
                <div class="url-input-container">
                    <input type="url" id="yamlUrl" placeholder="Enter YAML URL" style="width: 80%; padding: 0.5rem; margin-right: 0.5rem;">
                    <button onclick="fetchYaml()">Fetch YAML</button>
                </div>
                <div id="fetchError" class="fetch-error"></div>
                <textarea id="inputConfig" placeholder="Paste your Clash configuration here...
Example:
proxies:
  - name: 'Server 1'
    type: ss
    server: example.com
    port: 443
  - name: 'Server 2'
    type: vmess
    server: 192.168.1.1
    port: 8080"></textarea>
                <div class="button-container">
                    <button onclick="extractInfo()">Extract Information</button>
                    <button onclick="clearAll()">Clear All</button>
                </div>
                <div id="error" class="error"></div>
            </div>

            <div class="output-section">
                <div class="results-container">
                    <div class="result-section">
                        <h3>Domains <button onclick="copyListAsCSV('domainList', 'Domain')">Copy CSV</button> <button onclick="lookupDomains()">Lookup DNS</button></h3>
                        <ul id="domainList" class="result-list"></ul>
                    </div>
                    <div class="result-section">
                        <h3>IP Addresses <button onclick="copyListAsCSV('ipList', 'IP')">Copy CSV</button></h3>
                        <ul id="ipList" class="result-list"></ul>
                    </div>
                    <div class="result-section">
                        <h3>Resolved IPs <button onclick="copyListAsCSV('resolvedList', 'Resolved IP')">Copy CSV</button></h3>
                        <ul id="resolvedList" class="result-list"></ul>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        function extractInfo() {
            const input = document.getElementById('inputConfig').value;
            const error = document.getElementById('error');
            const domainList = document.getElementById('domainList');
            const ipList = document.getElementById('ipList');

            try {
                error.textContent = '';
                domainList.innerHTML = '';
                ipList.innerHTML = '';

                // Remove any BOM and non-printable characters except newlines
                const cleanInput = input.replace(/^\uFEFF/, '')  // Remove BOM
                                      .replace(/[^\x20-\x7E\n\r]/g, ''); // Keep only printable chars and newlines

                const config = jsyaml.load(cleanInput, { json: true });

                if (!config) {
                    throw new Error('Invalid YAML: Empty or invalid configuration');
                }

                if (!config.proxies || !Array.isArray(config.proxies)) {
                    throw new Error('Invalid Clash configuration: proxies field must be an array');
                }

                const domains = new Set();
                const ips = new Set();

                config.proxies.forEach((proxy, index) => {
                    if (!proxy || typeof proxy !== 'object') {
                        console.warn(`Skipping invalid proxy at index ${index}`);
                        return;
                    }

                    if (proxy.server) {
                        const server = proxy.server.toString().trim();
                        if (server) {
                            // Check if server is IP address
                            if (isIpAddress(server)) {
                                ips.add(server);
                            } else {
                                domains.add(server);
                            }
                        }
                    }
                });

                // Sort and display results
                [...domains].sort().forEach(domain => {
                    const li = document.createElement('li');
                    li.textContent = domain;
                    domainList.appendChild(li);
                });

                [...ips].sort((a, b) => {
                    // Sort IPs numerically
                    const partsA = a.split('.').map(Number);
                    const partsB = b.split('.').map(Number);
                    for (let i = 0; i < 4; i++) {
                        if (partsA[i] !== partsB[i]) {
                            return partsA[i] - partsB[i];
                        }
                    }
                    return 0;
                }).forEach(ip => {
                    const li = document.createElement('li');
                    li.textContent = ip;
                    ipList.appendChild(li);
                });

                // Show summary
                if (domains.size === 0 && ips.size === 0) {
                    error.textContent = 'No servers found in the configuration';
                }

            } catch (e) {
                error.textContent = `Error: ${e.message}`;
                console.error('Parsing error:', e);
            }
        }

        function isIpAddress(str) {
            // IPv4 validation
            const ipv4Regex = /^(\d{1,3}\.){3}\d{1,3}$/;
            if (ipv4Regex.test(str)) {
                // Validate each octet
                const octets = str.split('.');
                return octets.every(octet => {
                    const num = parseInt(octet, 10);
                    return num >= 0 && num <= 255;
                });
            }

            // IPv6 validation (including compressed format)
            const ipv6Regex = /^(?:(?:[0-9a-fA-F]{1,4}:){7}[0-9a-fA-F]{1,4}|(?:[0-9a-fA-F]{1,4}:){1,7}:|(?:[0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4}|(?:[0-9a-fA-F]{1,4}:){1,5}(?::[0-9a-fA-F]{1,4}){1,2}|(?:[0-9a-fA-F]{1,4}:){1,4}(?::[0-9a-fA-F]{1,4}){1,3}|(?:[0-9a-fA-F]{1,4}:){1,3}(?::[0-9a-fA-F]{1,4}){1,4}|(?:[0-9a-fA-F]{1,4}:){1,2}(?::[0-9a-fA-F]{1,4}){1,5}|[0-9a-fA-F]{1,4}:(?:(?::[0-9a-fA-F]{1,4}){1,6})|:(?:(?::[0-9a-fA-F]{1,4}){1,7}|:)|fe80:(?::[0-9a-fA-F]{0,4}){0,4}%[0-9a-zA-Z]{1,}|::(?:ffff(?::0{1,4}){0,1}:){0,1}(?:(?:25[0-5]|(?:2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(?:25[0-5]|(?:2[0-4]|1{0,1}[0-9]){0,1}[0-9])|(?:[0-9a-fA-F]{1,4}:){1,4}:(?:(?:25[0-5]|(?:2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(?:25[0-5]|(?:2[0-4]|1{0,1}[0-9]){0,1}[0-9]))$/;

            return ipv6Regex.test(str);
        }

        function copyListAsCSV(listId, type) {
            const list = document.getElementById(listId).getElementsByTagName('li');
            let csvContent = Array.from(list)
                .map(item => item.textContent.trim())
                .join(',');

            // Change button text to show feedback
            const button = document.querySelector(`button[onclick="copyListAsCSV('${listId}', '${type}')"]`);
            const originalText = button.textContent;
            button.textContent = 'Copied!';

            navigator.clipboard.writeText(csvContent)
                .then(() => {
                    // Reset button text after 2 seconds
                    setTimeout(() => {
                        button.textContent = originalText;
                    }, 2000);
                })
                .catch(err => {
                    console.error('Failed to copy data:', err);
                    button.textContent = 'Copy failed';
                    setTimeout(() => {
                        button.textContent = originalText;
                    }, 2000);
                });
        }

        async function lookupDomains() {
            const domainList = document.getElementById('domainList');
            const resolvedList = document.getElementById('resolvedList');
            const lookupButton = document.querySelector('button[onclick="lookupDomains()"]');
            const domains = Array.from(domainList.children).map(li => li.textContent);

            // Clear previous results
            resolvedList.innerHTML = '';

            // Add loading indicator
            const loading = document.createElement('span');
            loading.className = 'loading';
            loading.textContent = 'Looking up domains...';
            lookupButton.parentNode.appendChild(loading);
            lookupButton.disabled = true;

            try {
                for (const domain of domains) {
                    try {
                        // Using DNS.SB's DNS over HTTPS API
                        const response = await fetch(`https://dns.google.com/resolve?name=${encodeURIComponent(domain)}&type=A`);

                        if (!response.ok) {
                            throw new Error(`HTTP error! status: ${response.status}`);
                        }

                        const data = await response.json();

                        if (data.Answer && data.Answer.length > 0) {
                            // Get all A records
                            const ips = data.Answer
                                .filter(record => record.type === 1) // Type 1 is A record
                                .map(record => record.data);

                            if (ips.length > 0) {
                                // Add to resolved list
                                const li = document.createElement('li');
                                li.innerHTML = `${ips.join(', ')}`;
                                resolvedList.appendChild(li);
                            } else {
                                const li = document.createElement('li');
                                li.innerHTML = `No A records found`;
                                resolvedList.appendChild(li);
                            }
                        } else {
                            const li = document.createElement('li');
                            li.innerHTML = `No DNS records found`;
                            resolvedList.appendChild(li);
                        }
                    } catch (e) {
                        console.error(`Error resolving ${domain}:`, e);
                        // Try fallback DNS API if first one fails
                        try {
                            const response = await fetch(`https://cloudflare-dns.com/dns-query?name=${encodeURIComponent(domain)}&type=A`, {
                                headers: {
                                    'Accept': 'application/dns-json'
                                }
                            });

                            if (!response.ok) {
                                throw new Error(`HTTP error! status: ${response.status}`);
                            }

                            const data = await response.json();

                            if (data.Answer && data.Answer.length > 0) {
                                const ips = data.Answer
                                    .filter(record => record.type === 1)
                                    .map(record => record.data);

                                if (ips.length > 0) {
                                    const li = document.createElement('li');
                                    li.innerHTML = `${ips.join(', ')}`;
                                    resolvedList.appendChild(li);
                                    continue;
                                }
                            }
                            throw new Error('No A records found');
                        } catch (fallbackError) {
                            const li = document.createElement('li');
                            li.innerHTML = `Resolution failed: ${e.message}`;
                            resolvedList.appendChild(li);
                        }
                    }

                    // Add a small delay between requests to avoid rate limiting
                    await new Promise(resolve => setTimeout(resolve, 100));
                }
            } finally {
                // Remove loading indicator and re-enable button
                lookupButton.parentNode.removeChild(loading);
                lookupButton.disabled = false;
            }
        }

        async function fetchYaml() {
            const urlInput = document.getElementById('yamlUrl');
            const yamlTextarea = document.getElementById('inputConfig');
            const errorDisplay = document.getElementById('fetchError');
            const url = urlInput.value.trim();

            // Clear previous error
            errorDisplay.textContent = '';
            errorDisplay.classList.remove('show');

            if (!url) {
                showFetchError('Please enter a URL');
                return;
            }

            try {
                // Try to use a CORS proxy if direct fetch fails
                let response;
                try {
                    response = await fetch(url, {
                        method: 'GET',
                        mode: 'cors',
                        headers: {
                            'Accept': 'text/plain,application/yaml,text/yaml'
                        }
                    });
                } catch (directError) {
                    // If direct fetch fails, try using a CORS proxy
                    const corsProxyUrl = `https://api.allorigins.win/raw?url=${encodeURIComponent(url)}`;
                    response = await fetch(corsProxyUrl);
                }

                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                }

                const yamlContent = await response.text();

                // Validate that the content is YAML
                try {
                    jsyaml.load(yamlContent);
                } catch (yamlError) {
                    throw new Error('Invalid YAML format in the response');
                }

                yamlTextarea.value = yamlContent;
                // Automatically extract info after fetching
                extractInfo();
            } catch (error) {
                console.error('Error fetching YAML:', error);
                let errorMessage = 'Failed to fetch YAML content: ';

                if (error instanceof TypeError && error.message.includes('Failed to fetch')) {
                    errorMessage += 'CORS error - This URL does not allow direct access. ';
                    errorMessage += 'Try downloading the file and pasting its contents directly.';
                } else if (error.message.includes('Invalid YAML')) {
                    errorMessage += 'The URL did not return valid YAML content';
                } else {
                    errorMessage += error.message;
                }

                showFetchError(errorMessage);
            }
        }

        function showFetchError(message) {
            const errorDisplay = document.getElementById('fetchError');
            errorDisplay.textContent = message;
            errorDisplay.classList.add('show');
        }

        function clearAll() {
            document.getElementById('inputConfig').value = '';
            document.getElementById('domainList').innerHTML = '';
            document.getElementById('ipList').innerHTML = '';
            document.getElementById('resolvedList').innerHTML = '';
            document.getElementById('error').textContent = '';
            document.getElementById('fetchError').textContent = '';
            document.getElementById('fetchError').classList.remove('show');
        }
    </script>
</body>
</html>
